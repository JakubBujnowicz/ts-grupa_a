---
title: "Prognoza stopy bezrobobocia w Polsce na podstawie danych GUS"
author: 'Grupa A: Izabela Stobiecka, Anita Księżak, Sandra Sobór, Jakub Bujnowicz'
date: "21 kwietnia 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidyr)
library(RColorBrewer)
library(forecast)
library(tseries)
library(rvest)

rok <- 2019
```

Celem poniższego dokumentu jest analiza danych dotyczących stopy bezrobocia w Polsce na podstawie danych GUS i prognoza wysokości stopy na rok `r rok`.

## Wczytanie danych
Dane zostały wczytane i odpowiednio zmodyfikowane w oddzielnym R skrypcie. Tabela została wyodrębniona ze strony z usunięciem niepotrzebnych znaków, ujednoliceniem separatora dziesiętnego i dodaniem możliwości wyboru wariantu w roku 2002:

w wariancie "a"- dane według wyników z Powszechnego Spisu Rolnego 1996,

w wariancie "b"- dane według wyników z Narodowego Spisu Powszechnego Ludności i Mieszkań oraz Powszechnego Spisu Rolnego 2002

Ustalmy wariant, który weźmiemy pod uwagę:

```{r}
bezrobocie_typ <- "b"
```


Tabela została również przekształcona do postaci długiej. W ten sposób otrzymaliśmy ramkę danych złożoną z czterech kolumn- Rok, Miesiąc, Wartość i MiesiącInt (miesiąc w postaci liczby całkowitej)

```{r}
dane <- readRDS(paste0("dane/bezrobocie_",
                       bezrobocie_typ,
                       ".rds"))
names(dane) <- c("Rok", "Miesiac", "Wartosc", "MiesiacInt")
tail(dane)
```

Wprowadźmy zakres lat, dla kórych przeprowadzimy analizę:

```{r}
rokStart <- 2012
rokStop <- 2014
```


Ponieważ analizować będziemy dane z okresu `r rokStart ` do `r rokStop ` przekształćmy odpowienio dane. Pozbądźmy się wartości dla miesięcy,które nie wydarzyły się jeszcze w ostatnim roku. 

```{r}
licznik <- 1
for (i in 1 : 12){
    if(is.na(dane$Wartosc[i])){
        licznik <- licznik + 1
    }
}
    

if (rokStop == 2019){
    daneStart <- licznik
} else {
    daneStart <- which(dane$Rok==rokStop & dane$Miesiac == "grudzień")
}

daneStop <- which(dane$Rok==rokStart & dane$Miesiac == "styczeń")
```

Zatem początkowe wartości analizowanych danych przyjmują następujące wartości:

```{r}
dane <- dane[daneStart:daneStop,]
tail(dane)
```

##Podstawowe wykresy

Ustalmy zmienne start - piewszy parametr w szeregu czasowym oraz frequency - liczbę obserwacji na jednostkę czasu.

```{r}
s <- 1
f <- 12
```

[comment]: <> (?Czytam wartości p i q tutaj, czy już po zróżnicowaniu?)

Zdefiniujmy szereg czasowy opisujący nasze zjawisko i narysujmy dla niego podstawowe wykresy:

```{r}
bezrobocie <- ts(dane$Wartosc, start = s, frequency = f)
head(bezrobocie)
```
```{r}
tsdisplay(bezrobocie, main = "Bezrobocie w badanym okresie", col = brewer.pal(n = 4, name = "PRGn")[1])
```

Wprowadźmy parametr q, który odpowiada wartościom istotnie róznym od zera na wykresie ACF oraz parametr p, który odpowiada wartościom istotnie róznym od zera na wykresie PACF  Potrkatujmy je chwilowo jako "czarną skrzynkę". Okażą się one przydatne na dalszym etapie analizy.

```{r}
q <- 3
p <- 2
```


Narysujmy wykres (za pomocą **STL**) z którego wprost odczytamy oryginalne danr, trend, sezonowość i resztę.

```{r}
bezrobocie.stl = stl (bezrobocie, s.window = "periodic")
plot(bezrobocie.stl, col = brewer.pal(n = 4, name = "PRGn")[1])
```

Na podstawie powyższych wykresów jesteśmy w stanie odszukać potencjalne trendy i sezonowość. Dodatkowo możemy wyciągnąć wnioski dotyczące stacjonarności danych. 

[comment]: <> (Tutaj wnioski o trendach, sezonowości, stacjonarności)

Znając podstawowe własności analizowanego szeregu przejdźmy do dalszej - dokładniejszej analizy.

## AR, MA, ARMA, ARIMA

Aby analiza była dokładniejsza (szereg posiadał cechy słabej stacjonarności) zróżnicujmy eksplorowane dane.
```{r}
nsc <- diff(bezrobocie)
head(nsc)
```

Narysujmy wykresy przestawiające zróżnicowane dane.

```{r}
tsdisplay(nsc)
```

Przeanalizujmy dane korzystając z grupy modeli AR, MA, ARMA, ARIMA. Opisy dotyczące modeli pochodzą bezpośrednio ze [skrypt](https://github.com/PiotrMaciejKowalski/ts-r/tree/master/skrypt)u dla przedmiotu Szeregi czasowe i prognozowanie w biznesie 2018/19.

Modele **MA** są wyraźnie obserwowalne na wykresach ACF. Wykazują na nich szybą zbieżność do wartości
nieistotnie różnych od 0. Wystepowanie q-pierwszych zmiennych na wykresie ACF jako istotnie róznych od zera
sugeruje rozwazenie modelu MA(q), zatem na posdtawie wykresu ACF dla niezróżnicowanych danych wnioskujemy, że q=`r q`.

```{r}
ma <- Arima(nsc, order=c(0,0,q))
summary(ma)
```

W modelach **AR**(p) funkcja PACF przyjmuje wartości istotnie różne od 0 wyłącznie dla k≤p. Stąd to właśnie
tę funkcję stosujemy przy badaniu zasadnosci modelu. 

```{r}
ar <- Arima(nsc, order=c(p,0,q))
summary(ar)
```

W badaniu procesów **ARMA** wykresy ACF oraz PACF nie wnoszą istotnych informacji. Brak informacji płynącej
z wykresów ACF i PACF przy jednoczesnym przekonaniu o stacjonarności jest sygnałem do rozważenia modelu
ARMA. Zajmijmy się więc analizą modelu **ARIMA** (ang. Autoregressive integrated moving average - autoregresyjny(**AR**) (AR zintegrowany(**I**) model średniej ruchomej(**MA**)). W celu analizy danych skorzystamy z funkcji wbudowanej w R.

```{r}
arima <- auto.arima(nsc)
summary(arima)
```


## Podział na zbiór treningowy i testowy.

Zbiorem treningowym będą dane z miesięcy styczeń-luty, a zbiorem testowym dane z miesiąca marzec

```{r}
n <- length(nsc)
```

```{r}
zmiennaPodzial <- (n-12)
uczacy <- window(nsc,end = (zmiennaPodzial-1))
uczacy

testowy <- window(nsc,start = (zmiennaPodzial))
testowy
```

Wspólny wykres:

[comment]: <> (Jakiś błąd w podziale zbioru na zbiór uczący i testowy - ostatni rozdział to wersja robocza)
